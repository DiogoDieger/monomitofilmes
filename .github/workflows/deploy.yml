name: Deploy to Server

on:
  push:
    branches:
      - main # O workflow roda quando h√° push na branch 'main'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Testar Conectividade
      run: ping -c 4 nodejs36f02.kinghost.net

      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install SSHPass
        run: sudo apt-get install -y sshpass

      - name: Deploy via SSH with Password
        run: |
          sshpass -p "Huehuebr12" ssh -o StrictHostKeyChecking=no monomitofilmes@nodejs36f02.kinghost.net << EOF
            echo "üöÄ Iniciando Deploy..."

            # Entrar na pasta do projeto e atualizar com git pull
            cd /home/monomitofilmes/apps_nodejs/monomito-filmes
            git pull origin main
            
            # Apagar arquivos antigos da pasta www
            echo "üßπ Limpando a pasta www..."
            rm -rf /home/monomitofilmes/www/*
            
            # Mover os arquivos da pasta out para www
            echo "üìÇ Movendo arquivos da pasta out para www..."
            mv /home/monomitofilmes/apps_nodejs/monomito-filmes/out/* /home/monomitofilmes/www/

            echo "‚úÖ Deploy conclu√≠do com sucesso!"
          EOF
